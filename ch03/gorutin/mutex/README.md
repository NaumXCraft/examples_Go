* **Горутины**: каждая машина — отдельный параллельный поток выполнения.
* **Общий ресурс**: АЗС — единая точка, где без синхронизации возникнут гонки данных.
* **Mutex**: «одна машина за раз» в критической секции — гарантирует корректность остатков.
* **Отслеживание в реальном времени**: консольный лог — живой журнал системы (что и когда произошло).
* **Завершение**: координация через `WaitGroup`; программа заканчивается, когда все машины остановлены.

# 1) Архитектура и общая идея (кто с кем и зачем)

```
┌────────────────────────────────────────────────────────────────┐
│                          Главная программа (main)              │
│                                                                │
│  ┌──────────────┐   ┌──────────────┐        ┌──────────────┐   │
│  │  Car (BMW)   │   │  Car (Audi)  │  ...   │ Car (Skoda)  │   │
│  │ goroutine    │   │ goroutine    │        │ goroutine    │   │
│  └─────▲────────┘   └─────▲────────┘        └─────▲────────┘   │
│        │ расход топлива         │ расход топлива        │       │
│        │ (каждую секунду)       │ (каждую секунду)      │       │
│        │                        │                       │       │
│        │     запрос заправки    │      запрос заправки  │       │
│        │           ┌────────────┴───────────────┐       │       │
│        └──────────►│   GasStation (общий ресурс)│◄──────┘       │
│                    │ fuel: int/float            │               │
│                    │ sync.Mutex (крит. секция)  │               │
│                    └──────────┬─────────────────┘               │
│                               │                                  │
│                      атомарное уменьшение fuel                   │
└──────────────────────────────────────────────────────────────────┘
```

**Идея:** 10 независимых горутин «едут» и периодически просят заправку у **одного** общего ресурса (АЗС).
К АЗС — строго по одному: вход в критическую секцию через `Mutex`.

---

# 2) Критическая секция (что именно «атомарно» на АЗС)

```
func TryRefuelFull(c *Car) {
    LOCK(mutex)                 ← вход в критическую секцию (одновременно только одна машина)
        need = c.Capacity - c.Fuel
        if need <= fuel_on_station:
            fuel_on_station -= need
            c.Fuel += need   ← «полный бак» за одно действие
        else:
            отказ            ← «частичных доливок» нет
    UNLOCK(mutex)             ← выход (освобождаем «зону»)
}
```

---

# 3) Последовательность событий (sequence) для одной машины

```
Car (BMW)                         GasStation
   |                                   |
   |-- (тик) расход топлива ---------->|
   |                                   |
   | [бак опустел]                     |
   |----------- запрос refuel -------->|
   |                                   | LOCK(mutex)
   |                                   | проверка fuel и списание need
   |<---------- ответ: ОК/ОТКАЗ -------| UNLOCK(mutex)
   |                                   |
   | если ОК: продолжает ехать         |
   | если ОТКАЗ: останавливается       |
```

---

# 4) «Жизненный цикл» машины (state machine)

```
         ┌───────────────┐
         │   ЕДЕТ        │
         └───────┬───────┘
                 │ (топливо стало 0)
                 ▼
        ┌──────────────────┐
        │ ЕДЕТ НА ЗАПРАВКУ │   (лог: "бак пуст, еду на АЗС")
        └─────────┬────────┘
                  │ TryRefuelFull()
      ┌───────────┴───────────────┐
      ▼                           ▼
┌───────────────┐           ┌───────────────┐
│  ЗАПРАВИЛАСЬ  │           │ НЕТ ТОПЛИВА   │
│ (full tank)   │           │ НА АЗС        │
└───────┬───────┘           └───────┬───────┘
        │                           │
        │                           │
        ▼                           ▼
     «ЕДЕТ»                    «ОСТАНОВКА»
```

---

# 5) Тайм-лента нескольких машин (как читать консольный лог)

```
t=00s: [ТИК] BMW бак 19.5/60, Audi 29.7/55, Ford 34.3/62, ...
t=01s: [ТИК] BMW бак 19.0/60, Audi 29.4/55, Ford 33.6/62, ...
t=...: BMW: бак пуст → "Еду на заправку"
t=...: BMW: LOCK → проверка need ≤ fuel → ОК → "Заправилась", Остаток АЗС: 9940
t=...: [ТИК] BMW снова едет с полным баком
t=...: Honda: бак пуст → запрашивает → ОТКАЗ (топлива не хватает) → "Остановилась"
...
```
